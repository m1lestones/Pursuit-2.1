<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pursuit Dashboard Replica</title>
    <link rel="stylesheet" href="styles.css">

</head>

<body>

    <nav class="sidebar" aria-label="Primary">
        <div class="sidebar-top">
            <div class="logo" aria-label="Pursuit">
                <span class="logo-mark" aria-hidden="true">p</span>
            </div>
        </div>
        <div class="nav-icons" aria-label="Navigation">
            <button class="icon-btn" type="button" aria-label="Curriculum">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M4 6.5c0-1.4 1.1-2.5 2.5-2.5H20v16H6.5C5.1 20 4 18.9 4 17.5V6.5Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                    <path d="M8 7.5h8M8 11h8M8 14.5h6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    <path d="M6.5 4C5.1 4 4 5.1 4 6.5S5.1 9 6.5 9H20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                </svg>
            </button>

            <button class="icon-btn" type="button" aria-label="Messages">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M5 6.8C5 5.25 6.25 4 7.8 4h8.4C17.75 4 19 5.25 19 6.8v6.4c0 1.55-1.25 2.8-2.8 2.8H10l-4.1 3.1c-.5.38-1.2.02-1.2-.6V16c-.46-.5-.7-1.13-.7-1.8V6.8Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                    <path d="M8 8.5h8M8 11.5h6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                </svg>
            </button>

            <button class="icon-btn" type="button" aria-label="Calendar" aria-current="page">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M7 4v3M17 4v3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    <path d="M5.5 7.5h13" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    <path d="M6.5 5.5h11c1.1 0 2 .9 2 2v11c0 1.1-.9 2-2 2h-11c-1.1 0-2-.9-2-2v-11c0-1.1.9-2 2-2Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round" />
                    <path d="M8 11h3M8 14h3M13 11h3M13 14h3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                </svg>
            </button>

            <button class="icon-btn" type="button" aria-label="Go to curriculum">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M8 12h8" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
                    <path d="M13 7l5 5-5 5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>

            <button class="icon-btn" type="button" aria-label="Activity">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M4 12h4l2.1-5.5L13 17l2-5h5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
        </div>

        <div class="sidebar-bottom" aria-hidden="true">
            <div class="icon-divider"></div>
            <div class="icon-btn ghost">‚Ü•</div>
        </div>
    </nav>

    <main class="content">

        <header class="topbar">
            <div class="topbar-left">
                <h1 class="topbar-title">Hey Juan. Good to see you!</h1>
            </div>
            <div class="topbar-right">
                <div class="topbar-search" data-assignment-search>
                    <input class="search-input" type="search" autocomplete="off" spellcheck="false"
                        placeholder="Find assignment‚Ä¶" aria-label="Find assignment" data-search-input />
                    <div class="search-results" role="listbox" hidden data-search-results></div>
                </div>
                <button class="theme-toggle" type="button" data-theme-toggle aria-pressed="false"
                    aria-label="Toggle dark mode" title="Toggle day/night">
                    <span class="theme-toggle-icon" aria-hidden="true" data-theme-icon>üåô</span>
                    <span class="theme-toggle-text" data-theme-text>Night</span>
                </button>
                <div class="alert-pill" role="status" aria-label="Missed assignments" data-missed-assignments>
                    <span class="alert-dot" aria-hidden="true">üò¨</span>
                    <span><strong data-missed-count>1</strong> missed assignments</span>
                </div>
            </div>
        </header>

        <section class="hero" aria-label="Today goal">
            <div class="hero-card">
                <div class="hero-copy">
                    <h2 class="hero-eyebrow">Today's Goal</h2>
                    <p class="hero-text">Week 2 assessment (baseline) + UI/UX patterns + wireframe your product</p>
                    <button class="btn btn-primary btn-start" type="button"><span aria-hidden="true">‚ñ∂Ô∏è</span>
                        Start</button>
                </div>
            </div>
        </section>

        <section class="weekly-view" aria-label="Weekly curriculum">
            <div class="week-header">
                <div class="week-title">
                    <div class="week-kicker">L2: Week 2</div>
                    <div class="week-subtitle">Deeply analyze a product you love, learn UI/UX patterns to understand why
                        it works, and write a Full PRD together</div>

                    <div class="week-progress" aria-label="Weekly progress">
                        <div class="progress-line">
                            <span class="progress-label">Weekly progress</span>
                            <span class="progress-count" data-week-progress>0 / 0</span>
                        </div>
                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
                            data-week-progressbar>
                            <div class="progress-fill" data-week-progressfill></div>
                        </div>
                    </div>
                </div>

                <div class="week-controls" aria-label="Week controls">
                    <button class="ctrl-btn" type="button" aria-label="Previous week">‚Äπ</button>
                    <button class="week-dropdown" type="button" aria-label="Select week">
                        <span>Week 02</span>
                        <span aria-hidden="true">‚ñæ</span>
                    </button>
                    <button class="ctrl-btn" type="button" aria-label="Next week">‚Ä∫</button>
                </div>
            </div>

            <div class="dashboard-scroll" aria-label="Week days">
                <button class="scroll-btn" type="button" data-scroll-left aria-label="Scroll days left">‚Äπ</button>
                <div class="dashboard-scroll-viewport" data-dashboard-viewport>
                    <div class="dashboard-grid" role="list">
                <article class="day-card" data-day="2026-01-31" role="listitem" aria-label="Saturday">
                    <div class="day-head">
                        <div class="day-date">1.31 SAT</div>
                        <div class="day-head-actions">
                            <button class="expand-btn" type="button" data-expand-day aria-label="Expand day"
                                aria-expanded="false">
                                <span aria-hidden="true">‚§¢</span>
                            </button>
                            <div class="day-chip" aria-hidden="true">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="day-section-title">Activities</div>
                    <ul class="task-list">
                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Stand-up complete">
                                    <span class="task-title">Stand-up</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Quick check-in to share blockers and align with your cohort.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="required">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Week 2 kick-off complete">
                                    <span class="task-title">Week 2 kick-off</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Overview of expectations, deliverables, and the assessment
                                    schedule.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Week 1 presentations complete">
                                    <span class="task-title">Week 1 presentations ‚Äî First pair builds</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Observe patterns in structure and storytelling for later PRD work.
                                </p>
                            </div>
                        </li>

                        <li class="task task--separator" aria-label="Lunch break">
                            <div class="task-separator" data-lunch-timer data-default-minutes="30">
                                <div class="lunch-left">
                                    <span class="lunch-label">üçΩÔ∏è Lunch</span>
                                    <span class="lunch-countdown" data-lunch-countdown>30:00</span>
                                </div>
                                <div class="lunch-actions">
                                    <button class="lunch-btn" type="button" data-lunch-start>Start</button>
                                    <button class="lunch-btn" type="button" data-lunch-stop disabled>Pause</button>
                                    <button class="lunch-btn" type="button" data-lunch-reset>Reset</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="optional" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Git basics complete">
                                    <span class="task-title">Git basics + shared repo setup</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Optional refresher to keep your workflow smooth this week.</p>
                                <div class="task-actions">
                                    <button class="btn btn-secondary" type="button"><span aria-hidden="true">üìé</span>
                                        Submit Link</button>
                                </div>
                            </div>
                        </li>
                    </ul>

                    <div class="day-footer">
                        <div class="day-progress">
                            <div class="progress-line">
                                <span class="progress-label">Daily progress</span>
                                <span class="progress-count" data-day-progress>0 / 0</span>
                            </div>
                            <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                aria-valuenow="0" data-day-progressbar>
                                <div class="progress-fill" data-day-progressfill></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="day-card" data-day="2026-02-01" role="listitem" aria-label="Sunday">
                    <div class="day-head">
                        <div class="day-date">2.1 SUN</div>
                        <div class="day-head-actions">
                            <button class="expand-btn" type="button" data-expand-day aria-label="Expand day"
                                aria-expanded="false">
                                <span aria-hidden="true">‚§¢</span>
                            </button>
                            <div class="day-chip" aria-hidden="true">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="day-section-title">Activities</div>
                    <ul class="task-list">
                        <li class="task" data-tag="required" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Week 2 assessment technical complete">
                                    <span class="task-title">Week 2 assessment <span class="task-muted">[Technical]:
                                            Propose and implement product improvements</span></span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Submit your technical proposal and any implementation notes.</p>
                                <div class="task-actions">
                                    <button class="btn btn-primary" type="button"><span aria-hidden="true">‚¨ÜÔ∏è</span>
                                        Submit Assessment</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="required">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Week 2 assessment business complete">
                                    <span class="task-title">Week 2 assessment <span class="task-muted">[Business]:
                                            Justify highest-value improvements</span></span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Explain tradeoffs and why your improvements matter most.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark video explanation complete">
                                    <span class="task-title">Week 2 assessment <span class="task-muted">[Professional]:
                                            Video explanation for CEO</span></span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Record a short, clear walkthrough of your recommendations.</p>
                                <div class="task-actions">
                                    <button class="btn btn-secondary" type="button"><span aria-hidden="true">üé•</span>
                                        Upload Video</button>
                                </div>
                            </div>
                        </li>

                        <li class="task task--separator" aria-label="Lunch break">
                            <div class="task-separator" data-lunch-timer data-default-minutes="30">
                                <div class="lunch-left">
                                    <span class="lunch-label">üçΩÔ∏è Lunch</span>
                                    <span class="lunch-countdown" data-lunch-countdown>30:00</span>
                                </div>
                                <div class="lunch-actions">
                                    <button class="lunch-btn" type="button" data-lunch-start>Start</button>
                                    <button class="lunch-btn" type="button" data-lunch-stop disabled>Pause</button>
                                    <button class="lunch-btn" type="button" data-lunch-reset>Reset</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark UI/UX patterns learning complete">
                                    <span class="task-title">UI/UX patterns ‚Äî Individual learning</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Focus on patterns that reduce scanning effort and increase clarity.
                                </p>
                            </div>
                        </li>
                    </ul>

                    <div class="day-footer">
                        <div class="day-progress">
                            <div class="progress-line">
                                <span class="progress-label">Daily progress</span>
                                <span class="progress-count" data-day-progress>0 / 0</span>
                            </div>
                            <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                aria-valuenow="0" data-day-progressbar>
                                <div class="progress-fill" data-day-progressfill></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="day-card day-card--today" data-day="2026-02-02" role="listitem" aria-label="Monday"
                    data-selected="true">
                    <div class="day-head">
                        <div class="day-date"><span class="today-label">TODAY</span> 2.2 MON</div>
                        <div class="day-head-actions">
                            <button class="expand-btn" type="button" data-expand-day aria-label="Expand day"
                                aria-expanded="false">
                                <span aria-hidden="true">‚§¢</span>
                            </button>
                            <div class="day-chip" aria-hidden="true">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="today-focus" aria-label="Today focus">
                        <div class="today-focus-head">
                            <span class="today-focus-title">üéØ Today‚Äôs Focus</span>
                            <div class="today-focus-right">
                                <button class="next-action-btn" type="button" data-next-action>
                                    <span aria-hidden="true">üöÄ</span> Next best action
                                </button>
                                <span class="status-pill" data-status-pill>On track</span>
                            </div>
                        </div>
                        <ol class="today-focus-list" data-today-focus-list>
                            <!-- populated by script -->
                        </ol>
                    </div>

                    <div class="day-section-title">Activities</div>
                    <ul class="task-list">
                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Stand-up complete">
                                    <span class="task-title">Stand-up</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Set today‚Äôs intent and surface blockers early.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="required" data-focus="true" data-action="watch">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Mini L2L complete">
                                    <span class="task-title">Mini L2L: Shapes of stories</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Short required lesson to tighten narrative and hierarchy.</p>
                                <div class="task-actions">
                                    <button class="btn btn-primary" type="button"><span aria-hidden="true">‚ñ∂Ô∏è</span>
                                        Watch Required Video</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="required" data-focus="true" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark PRD Red Teaming complete">
                                    <span class="task-title">PRD ‚ÄúRed Teaming‚Äù</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Identify risks, edge cases, and unclear requirements before writing
                                    the PRD.</p>
                                <div class="task-actions">
                                    <button class="btn btn-primary" type="button"><span aria-hidden="true">üìé</span>
                                        Upload PRD Draft</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Pair check-in complete">
                                    <span class="task-title">Pair check-in</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Confirm roles, timelines, and next actions with your partner.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="required" data-focus="true" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Business deep dive complete">
                                    <span class="task-title">Product analysis: Business deep dive</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Write 3‚Äì5 bullets: users, value prop, and business model
                                    assumptions.</p>
                                <div class="task-actions">
                                    <button class="btn btn-primary" type="button"><span aria-hidden="true">‚¨ÜÔ∏è</span>
                                        Submit Analysis</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Retro complete">
                                    <span class="task-title">Retro</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Quick reflection to improve your system for the rest of the week.
                                </p>
                            </div>
                        </li>
                    </ul>

                    <div class="day-footer">
                        <div class="day-progress">
                            <div class="progress-line">
                                <span class="progress-label">Daily progress</span>
                                <span class="progress-count" data-day-progress>0 / 0</span>
                            </div>
                            <div class="progress progress--on-dark" role="progressbar" aria-valuemin="0"
                                aria-valuemax="100" aria-valuenow="0" data-day-progressbar>
                                <div class="progress-fill" data-day-progressfill></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="day-card" data-day="2026-02-03" role="listitem" aria-label="Tuesday">
                    <div class="day-head">
                        <div class="day-date">2.3 TUE</div>
                        <div class="day-head-actions">
                            <button class="expand-btn" type="button" data-expand-day aria-label="Expand day"
                                aria-expanded="false">
                                <span aria-hidden="true">‚§¢</span>
                            </button>
                            <div class="day-chip" aria-hidden="true">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="day-section-title">Activities</div>
                    <ul class="task-list">
                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Mini L2L product history complete">
                                    <span class="task-title">Mini L2L product history</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Build context for why the product evolved the way it did.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="required">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark history deep dive complete">
                                    <span class="task-title">Product analysis: History deep dive</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Capture timeline milestones and key inflection points.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark feedback refresher complete">
                                    <span class="task-title">Feedback refresher: How to give great feedback</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Use a structured feedback rubric during share-outs.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark pair share-outs complete">
                                    <span class="task-title">Pair share-outs ‚Äî product analysis progress</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Share what‚Äôs clear and what needs more evidence.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Retro complete">
                                    <span class="task-title">Retro</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Close out the day with one improvement for tomorrow.</p>
                            </div>
                        </li>
                    </ul>

                    <div class="day-footer">
                        <div class="day-progress">
                            <div class="progress-line">
                                <span class="progress-label">Daily progress</span>
                                <span class="progress-count" data-day-progress>0 / 0</span>
                            </div>
                            <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                aria-valuenow="0" data-day-progressbar>
                                <div class="progress-fill" data-day-progressfill></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="day-card" data-day="2026-02-04" role="listitem" aria-label="Wednesday">
                    <div class="day-head">
                        <div class="day-date">2.4 WED</div>
                        <div class="day-head-actions">
                            <button class="expand-btn" type="button" data-expand-day aria-label="Expand day"
                                aria-expanded="false">
                                <span aria-hidden="true">‚§¢</span>
                            </button>
                            <div class="day-chip" aria-hidden="true">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="day-section-title">Activities</div>
                    <ul class="task-list">
                        <li class="task" data-tag="required">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Stand-up complete">
                                    <span class="task-title">Stand-up</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Align on final PRD polishing plan and timing.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="required" data-action="submit">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Final PRD polish complete">
                                    <span class="task-title">Final PRD polish</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--required"><span aria-hidden="true">üî¥</span> Required</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Tighten language, acceptance criteria, and success metrics.</p>
                                <div class="task-actions">
                                    <button class="btn btn-primary" type="button"><span aria-hidden="true">‚¨ÜÔ∏è</span>
                                        Submit PRD</button>
                                </div>
                            </div>
                        </li>

                        <li class="task" data-tag="recommended">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark Presentation prep complete">
                                    <span class="task-title">Presentation prep</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--recommended"><span aria-hidden="true">üü°</span>
                                        Recommended</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Create a 3‚Äì5 minute narrative focused on priorities and tradeoffs.
                                </p>
                            </div>
                        </li>

                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox"
                                        aria-label="Mark practice with another pair complete">
                                    <span class="task-title">Presentation practice with another pair</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Get fast feedback on clarity and hierarchy.</p>
                            </div>
                        </li>

                        <li class="task" data-tag="optional">
                            <div class="task-row">
                                <label class="task-checkwrap">
                                    <input class="task-check" type="checkbox" aria-label="Mark Retro complete">
                                    <span class="task-title">Retro</span>
                                </label>
                                <div class="task-right">
                                    <span class="tag tag--optional"><span aria-hidden="true">‚ö™</span> Optional</span>
                                    <button class="task-toggle" type="button" aria-expanded="false">Details</button>
                                </div>
                            </div>
                            <div class="task-detail" hidden>
                                <p class="task-desc">Close the week with wins, lessons, and next experiments.</p>
                            </div>
                        </li>
                    </ul>

                    <div class="day-footer">
                        <div class="day-progress">
                            <div class="progress-line">
                                <span class="progress-label">Daily progress</span>
                                <span class="progress-count" data-day-progress>0 / 0</span>
                            </div>
                            <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                aria-valuenow="0" data-day-progressbar>
                                <div class="progress-fill" data-day-progressfill></div>
                            </div>
                        </div>
                    </div>
                </article>
                    </div>
                </div>
                <button class="scroll-btn" type="button" data-scroll-right aria-label="Scroll days right">‚Ä∫</button>
            </div>
        </section>
    </main>

    <div class="toast-stack" aria-live="polite" aria-atomic="true" data-toast-stack></div>

    <script>
        const TEST_MODE = new URLSearchParams(window.location.search).has('test');

        const TAG_WEIGHT = {
            required: 3,
            recommended: 2,
            optional: 1,
        };

        const TAG_EMOJI = {
            required: 'üî¥',
            recommended: 'üü°',
            optional: '‚ö™',
        };

        const REMINDER_MINUTES = 60;
        const LUNCH_STORAGE_KEY = `pursuit:lunchTimers:v1${TEST_MODE ? ':test' : ''}`;
        const MISSED_STORAGE_KEY = `pursuit:missedAssignments:v1${TEST_MODE ? ':test' : ''}`;
        const TASKS_STORAGE_KEY = `pursuit:taskChecks:v1${TEST_MODE ? ':test' : ''}`;
        const SELECTED_DAY_STORAGE_KEY = `pursuit:selectedDay:v1${TEST_MODE ? ':test' : ''}`;
        const CURRICULUM_STORAGE_KEY = `pursuit:curriculum:v1${TEST_MODE ? ':test' : ''}`;
        const THEME_STORAGE_KEY = `pursuit:theme:v1`;

        const TEST_REMINDER_INTERVAL_MS = 10 * 1000;
        const TEST_LUNCH_DEFAULT_MS = 20 * 1000;

        let TASK_STATE = {};

        function loadJson(key, fallback) {
            try {
                const raw = localStorage.getItem(key);
                return raw ? JSON.parse(raw) : fallback;
            } catch {
                return fallback;
            }
        }

        function saveJson(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch {
                // ignore
            }
        }

        function systemPrefersDark() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }

        function getStoredTheme() {
            try {
                const t = localStorage.getItem(THEME_STORAGE_KEY);
                return t === 'dark' || t === 'light' ? t : null;
            } catch {
                return null;
            }
        }

        function setStoredTheme(theme) {
            try {
                localStorage.setItem(THEME_STORAGE_KEY, theme);
            } catch {
                // ignore
            }
        }

        function applyTheme(theme) {
            const root = document.documentElement;
            root.dataset.theme = theme;

            const btn = document.querySelector('[data-theme-toggle]');
            const icon = document.querySelector('[data-theme-icon]');
            const text = document.querySelector('[data-theme-text]');
            const isDark = theme === 'dark';

            if (btn) btn.setAttribute('aria-pressed', String(isDark));
            if (icon) icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            if (text) text.textContent = isDark ? 'Day' : 'Night';
        }

        function initThemeToggle() {
            const btn = document.querySelector('[data-theme-toggle]');
            const initial = getStoredTheme() || (systemPrefersDark() ? 'dark' : 'light');
            applyTheme(initial);

            if (!btn) return;
            btn.addEventListener('click', () => {
                const current = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
                const next = current === 'dark' ? 'light' : 'dark';
                setStoredTheme(next);
                applyTheme(next);
            });

            if (window.matchMedia) {
                const media = window.matchMedia('(prefers-color-scheme: dark)');
                const onChange = () => {
                    // Only follow system changes if user hasn't explicitly chosen.
                    if (getStoredTheme()) return;
                    applyTheme(systemPrefersDark() ? 'dark' : 'light');
                };
                if (typeof media.addEventListener === 'function') media.addEventListener('change', onChange);
                else if (typeof media.addListener === 'function') media.addListener(onChange);
            }
        }

        function taskStorageKeyFor(taskEl) {
            if (!taskEl) return null;
            const dayCard = taskEl.closest('.day-card');
            const day = dayCard?.dataset.day || 'unknown-day';
            const tasks = dayCard ? getTasks(dayCard) : [];
            const idx = tasks.indexOf(taskEl);
            const title = taskEl.querySelector('.task-title')?.textContent?.trim() || 'task';
            const safeTitle = encodeURIComponent(title.slice(0, 80));
            return `${day}:task:${idx}:${safeTitle}`;
        }

        function loadTaskState() {
            const state = loadJson(TASKS_STORAGE_KEY, {});
            return state && typeof state === 'object' ? state : {};
        }

        function saveTaskState(state) {
            saveJson(TASKS_STORAGE_KEY, state);
        }

        function applyTaskState(state) {
            const tasks = getTasks(document);
            for (const task of tasks) {
                const check = task.querySelector('.task-check');
                if (!check) continue;
                const key = taskStorageKeyFor(task);
                if (!key) continue;
                if (typeof state[key] === 'boolean') check.checked = state[key];
            }
        }

        function clearSelectedCards() {
            const cards = Array.from(document.querySelectorAll('.day-card'));
            for (const card of cards) {
                card.classList.remove('day-card--selected');
                card.removeAttribute('aria-selected');
            }
        }

        function selectCard(card) {
            if (!card) return;
            clearSelectedCards();
            card.classList.add('day-card--selected');
            card.setAttribute('aria-selected', 'true');
            const day = card.dataset.day;
            if (day) {
                try {
                    localStorage.setItem(SELECTED_DAY_STORAGE_KEY, day);
                } catch {
                    // ignore
                }
            }
        }

        function restoreSelectedCard() {
            let storedDay = null;
            try {
                storedDay = localStorage.getItem(SELECTED_DAY_STORAGE_KEY);
            } catch {
                storedDay = null;
            }

            const byStored = storedDay
                ? document.querySelector(`.day-card[data-day="${CSS.escape(storedDay)}"]`)
                : null;
            const byDataSelected = document.querySelector('.day-card[data-selected="true"]');
            const today = document.querySelector('.day-card--today');

            selectCard(byStored || byDataSelected || today);
        }

        function serializeCard(card) {
            const dateText = card.querySelector('.day-date')?.textContent?.trim() || '';
            const dateShort = dateText.replace(/^TODAY\s+/i, '').trim();

            const goal = document.querySelector('.hero-text')?.textContent?.trim() || '';

            const items = [];
            const taskEls = Array.from(card.querySelectorAll('.task-list .task'));
            for (const task of taskEls) {
                if (task.classList.contains('task--separator')) {
                    const label = task.querySelector('.lunch-label')?.textContent?.trim() || 'Break';
                    items.push({ type: 'separator', label });
                    continue;
                }

                const title = task.querySelector('.task-title')?.textContent?.trim() || 'Task';
                const tag = task.dataset.tag || 'optional';
                const emoji = tag === 'required' ? 'üî¥' : tag === 'recommended' ? 'üü°' : '‚ö™';
                items.push({ type: 'task', title, tag, emoji });
            }

            return {
                dateShort,
                dateLong: dateText,
                goal,
                items,
            };
        }

        function buildAssignmentIndexFromDom() {
            const cards = Array.from(document.querySelectorAll('.day-card[data-day]'));
            const dayOrder = new Map(cards.map((c, i) => [c.dataset.day, i]));

            const index = [];
            for (const card of cards) {
                const day = card.dataset.day;
                if (!day) continue;

                const dateLong = card.querySelector('.day-date')?.textContent?.trim() || '';
                const dateShort = dateLong.replace(/^TODAY\s+/i, '').trim();
                const label = card.getAttribute('aria-label') || '';

                const taskEls = Array.from(card.querySelectorAll('.task-list .task'));
                let taskIdx = 0;
                for (const taskEl of taskEls) {
                    if (taskEl.classList.contains('task--separator')) continue;
                    const title = taskEl.querySelector('.task-title')?.textContent?.trim() || '';
                    if (!title) continue;
                    const tag = taskEl.dataset.tag || 'optional';

                    index.push({
                        day,
                        dateShort,
                        dateLong,
                        label,
                        title,
                        tag,
                        emoji: TAG_EMOJI[tag] || '‚ö™',
                        weight: TAG_WEIGHT[tag] || 0,
                        dayIdx: dayOrder.get(day) ?? 9999,
                        taskIdx: taskIdx++,
                    });
                }
            }

            return index;
        }

        function initAssignmentSearch() {
            const wrap = document.querySelector('[data-assignment-search]');
            const input = document.querySelector('[data-search-input]');
            const resultsEl = document.querySelector('[data-search-results]');
            if (!wrap || !input || !resultsEl) return;

            let assignmentIndex = buildAssignmentIndexFromDom();
            let activeIndex = -1;
            let lastQuery = '';

            const close = () => {
                resultsEl.hidden = true;
                resultsEl.innerHTML = '';
                activeIndex = -1;
            };

            const open = () => {
                if (resultsEl.childElementCount > 0) resultsEl.hidden = false;
            };

            const setActive = (idx) => {
                const options = Array.from(resultsEl.querySelectorAll('[data-search-option]'));
                if (!options.length) {
                    activeIndex = -1;
                    return;
                }
                activeIndex = Math.max(0, Math.min(options.length - 1, idx));
                for (const [i, el] of options.entries()) {
                    if (i === activeIndex) el.setAttribute('aria-selected', 'true');
                    else el.removeAttribute('aria-selected');
                }
                options[activeIndex].scrollIntoView({ block: 'nearest' });
            };

            const selectResult = (item) => {
                if (!item?.day) return;
                const card = document.querySelector(`.day-card[data-day="${CSS.escape(item.day)}"]`);
                if (card) navigateToDay(card);
                close();
            };

            const renderResults = (items, query) => {
                resultsEl.innerHTML = '';

                if (!query) {
                    close();
                    return;
                }

                if (!items.length) {
                    const empty = document.createElement('div');
                    empty.className = 'search-empty';
                    empty.textContent = 'No matches.';
                    resultsEl.appendChild(empty);
                    resultsEl.hidden = false;
                    return;
                }

                for (const item of items) {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'search-option';
                    btn.setAttribute('role', 'option');
                    btn.setAttribute('data-search-option', '');
                    btn.innerHTML = `
                        <div class="search-option-main">
                            <div class="search-option-title">${item.title}</div>
                            <div class="search-option-meta">${item.dateShort || item.label || item.day}</div>
                        </div>
                        <div class="search-option-right">
                            <span class="tag tag--${item.tag}"><span aria-hidden="true">${item.emoji}</span> ${item.tag}</span>
                        </div>
                    `;
                    btn.addEventListener('click', () => selectResult(item));
                    resultsEl.appendChild(btn);
                }

                resultsEl.hidden = false;
                setActive(0);
            };

            const search = (query) => {
                const q = String(query || '').trim().toLowerCase();
                lastQuery = q;
                if (!q) {
                    close();
                    return;
                }

                // Keep index fresh if curriculum changes.
                assignmentIndex = buildAssignmentIndexFromDom();

                const filtered = assignmentIndex
                    .filter((it) => it.title.toLowerCase().includes(q))
                    .sort((a, b) => {
                        if (b.weight !== a.weight) return b.weight - a.weight;
                        if (a.dayIdx !== b.dayIdx) return a.dayIdx - b.dayIdx;
                        return a.taskIdx - b.taskIdx;
                    })
                    .slice(0, 14);

                renderResults(filtered, q);
            };

            input.addEventListener('input', () => search(input.value));
            input.addEventListener('focus', () => {
                if (resultsEl.childElementCount > 0) open();
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    close();
                    input.blur();
                    return;
                }

                if (resultsEl.hidden) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setActive(activeIndex + 1);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setActive(activeIndex - 1);
                } else if (e.key === 'Enter') {
                    const options = Array.from(resultsEl.querySelectorAll('[data-search-option]'));
                    const el = options[activeIndex];
                    if (!el) return;
                    e.preventDefault();
                    // Re-run search to ensure we have latest ordering.
                    const q = lastQuery;
                    const list = assignmentIndex
                        .filter((it) => it.title.toLowerCase().includes(q))
                        .sort((a, b) => {
                            if (b.weight !== a.weight) return b.weight - a.weight;
                            if (a.dayIdx !== b.dayIdx) return a.dayIdx - b.dayIdx;
                            return a.taskIdx - b.taskIdx;
                        })
                        .slice(0, 14);
                    const item = list[activeIndex];
                    if (item) selectResult(item);
                }
            });

            document.addEventListener('click', (e) => {
                if (e.target.closest('[data-assignment-search]')) return;
                close();
            });

            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
                    e.preventDefault();
                    input.focus();
                    input.select();
                }
            });
        }

        function saveCurriculumSnapshot() {
            const grid = document.querySelector('.dashboard-grid');
            if (!grid) return;
            const cards = Array.from(grid.querySelectorAll('.day-card'));
            const map = {};
            for (const card of cards) {
                const day = card.dataset.day;
                if (!day) continue;
                map[day] = serializeCard(card);
            }
            try {
                localStorage.setItem(CURRICULUM_STORAGE_KEY, JSON.stringify(map));
            } catch {
                // ignore
            }
        }

        function navigateToDay(card) {
            if (!card) return;
            const day = card.dataset.day;
            if (!day) return;
            selectCard(card);
            saveCurriculumSnapshot();
            window.location.href = `day.html?day=${encodeURIComponent(day)}${TEST_MODE ? '&test=1' : ''}`;
        }

        function bindDayNavigation() {
            const grid = document.querySelector('.dashboard-grid');
            if (!grid) return;

            grid.addEventListener('click', (e) => {
                // Don‚Äôt navigate if user is interacting with controls.
                if (e.target.closest('button, input, a, label')) return;
                const card = e.target.closest('.day-card');
                if (!card) return;
                navigateToDay(card);
            });
        }

        function pad2(n) {
            return String(n).padStart(2, '0');
        }

        function msToMMSS(ms) {
            const clamped = Math.max(0, ms);
            const totalSeconds = Math.floor(clamped / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${pad2(minutes)}:${pad2(seconds)}`;
        }

        function getToastStack() {
            return document.querySelector('[data-toast-stack]');
        }

        function showToast({ title, message, tone = 'info', timeoutMs = 7000 }) {
            const stack = getToastStack();
            if (!stack) return;

            const toast = document.createElement('div');
            toast.className = `toast toast--${tone}`;
            toast.setAttribute('role', 'status');
            toast.innerHTML = `
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" type="button" aria-label="Dismiss">√ó</button>
            `;

            const close = () => {
                toast.classList.add('toast--hide');
                window.setTimeout(() => toast.remove(), 200);
            };

            toast.querySelector('.toast-close')?.addEventListener('click', close);
            stack.appendChild(toast);
            if (timeoutMs > 0) window.setTimeout(close, timeoutMs);
        }

        function mountTestModePill() {
            if (!TEST_MODE) return;
            const host = document.querySelector('.topbar-right');
            if (!host) return;

            const pill = document.createElement('div');
            pill.className = 'test-pill';
            pill.setAttribute('role', 'status');
            pill.textContent = 'üß™ Test mode ON';
            pill.title = 'Fast reminders/timers enabled. Remove ?test=1 to disable.';
            host.prepend(pill);

            showToast({
                title: 'üß™ Test mode ON',
                message: 'Fast reminders and lunch timers enabled for testing.',
                tone: 'info',
                timeoutMs: 5000,
            });
        }

        function playBeep() {
            try {
                const AudioCtx = window.AudioContext || window.webkitAudioContext;
                if (!AudioCtx) return;
                const ctx = new AudioCtx();
                const o = ctx.createOscillator();
                const g = ctx.createGain();
                o.type = 'sine';
                o.frequency.value = 880;
                g.gain.value = 0.05;
                o.connect(g);
                g.connect(ctx.destination);
                o.start();
                setTimeout(() => {
                    o.stop();
                    ctx.close();
                }, 250);
            } catch {
                // no-op
            }
        }

        async function maybeNotify(title, body) {
            if (!('Notification' in window)) {
                showToast({ title, message: body, tone: 'info' });
                return;
            }

            if (Notification.permission === 'default') {
                try {
                    await Notification.requestPermission();
                } catch {
                    // ignore
                }
            }

            if (Notification.permission === 'granted') {
                try {
                    new Notification(title, { body });
                    return;
                } catch {
                    // fall through
                }
            }

            showToast({ title, message: body, tone: 'info' });
        }

        function getTasks(root = document) {
            return Array.from(root.querySelectorAll('.task-list .task')).filter((li) => !li.classList.contains('task--separator'));
        }

        function setProgress(progressEl, fillEl, countEl, done, total) {
            const pct = total === 0 ? 0 : Math.round((done / total) * 100);
            if (fillEl) fillEl.style.width = `${pct}%`;
            if (countEl) countEl.textContent = `${done} / ${total}`;
            if (progressEl) progressEl.setAttribute('aria-valuenow', String(pct));
        }

        function updateDayProgress(dayCard) {
            const tasks = getTasks(dayCard);
            const checks = tasks.map((t) => t.querySelector('.task-check')).filter(Boolean);
            const total = checks.length;
            const done = checks.filter((c) => c.checked).length;

            const progressEl = dayCard.querySelector('[data-day-progressbar]');
            const fillEl = dayCard.querySelector('[data-day-progressfill]');
            const countEl = dayCard.querySelector('[data-day-progress]');

            setProgress(progressEl, fillEl, countEl, done, total);
            return { done, total };
        }

        function updateWeekProgress() {
            const allTasks = getTasks(document);
            const allChecks = allTasks.map((t) => t.querySelector('.task-check')).filter(Boolean);
            const total = allChecks.length;
            const done = allChecks.filter((c) => c.checked).length;

            const progressEl = document.querySelector('[data-week-progressbar]');
            const fillEl = document.querySelector('[data-week-progressfill]');
            const countEl = document.querySelector('[data-week-progress]');
            setProgress(progressEl, fillEl, countEl, done, total);
        }

        function deriveTodayFocus(todayCard) {
            const focusList = todayCard.querySelector('[data-today-focus-list]');
            if (!focusList) return;

            const tasks = getTasks(todayCard);
            const focus = tasks
                .filter((t) => t.dataset.focus === 'true')
                .map((t) => {
                    const titleEl = t.querySelector('.task-title');
                    const tag = t.dataset.tag || 'optional';
                    const check = t.querySelector('.task-check');
                    return {
                        el: t,
                        title: titleEl ? titleEl.textContent.trim() : 'Task',
                        tag,
                        done: check ? check.checked : false,
                        weight: TAG_WEIGHT[tag] ?? 0,
                    };
                })
                .sort((a, b) => b.weight - a.weight)
                .slice(0, 3);

            focusList.innerHTML = '';
            for (const item of focus) {
                const li = document.createElement('li');
                li.className = 'today-focus-item';
                const tagEmoji = TAG_EMOJI[item.tag] || '‚Ä¢';
                li.innerHTML = `
                    <span class="focus-check" aria-hidden="true">${item.done ? '‚úì' : '‚Ä¢'}</span>
                    <span class="focus-title">${item.title}</span>
                    <span class="focus-tag">${tagEmoji} ${item.tag}</span>
                `;
                focusList.appendChild(li);
            }

            if (focus.length === 0) {
                const li = document.createElement('li');
                li.className = 'today-focus-item';
                li.textContent = 'No critical items flagged yet.';
                focusList.appendChild(li);
            }
        }

        function updateStatusPill(todayCard) {
            const pill = todayCard.querySelector('[data-status-pill]');
            if (!pill) return;

            const requiredTasks = getTasks(todayCard).filter((t) => (t.dataset.tag || '') === 'required');
            const requiredChecks = requiredTasks.map((t) => t.querySelector('.task-check')).filter(Boolean);
            const requiredDone = requiredChecks.filter((c) => c.checked).length;
            const requiredTotal = requiredChecks.length;

            let statusText = 'On track';
            let statusClass = 'status-pill--good';
            let statusEmoji = '‚úÖ';

            if (requiredTotal > 0 && requiredDone === 0) {
                statusText = 'Behind';
                statusClass = 'status-pill--warn';
                statusEmoji = '‚è∞';
            } else if (requiredTotal > 0 && requiredDone < requiredTotal) {
                statusText = 'In progress';
                statusClass = 'status-pill--mid';
                statusEmoji = '‚ö†Ô∏è';
            }

            pill.textContent = `${statusEmoji} ${statusText}`;
            pill.classList.remove('status-pill--good', 'status-pill--mid', 'status-pill--warn');
            pill.classList.add(statusClass);
        }

        function getMissedCount() {
            const el = document.querySelector('[data-missed-count]');
            if (!el) return 0;
            const n = Number(String(el.textContent).trim());
            return Number.isFinite(n) ? n : 0;
        }

        function pulseMissedAssignments(durationMs = 15000) {
            const pill = document.querySelector('[data-missed-assignments]');
            if (!pill) return;
            pill.classList.add('alert-pill--pulse');
            window.setTimeout(() => pill.classList.remove('alert-pill--pulse'), durationMs);
        }

        function startMissedAssignmentReminders() {
            const missed = getMissedCount();
            if (missed <= 0) return;

            pulseMissedAssignments(20000);
            const now = Date.now();
            const stateRaw = localStorage.getItem(MISSED_STORAGE_KEY);
            const state = stateRaw ? JSON.parse(stateRaw) : {};
            const lastReminderAt = typeof state.lastReminderAt === 'number' ? state.lastReminderAt : 0;
            const minGapMs = TEST_MODE ? TEST_REMINDER_INTERVAL_MS : REMINDER_MINUTES * 60 * 1000;

            const shouldRemindNow = now - lastReminderAt > minGapMs;
            if (shouldRemindNow) {
                localStorage.setItem(MISSED_STORAGE_KEY, JSON.stringify({ lastReminderAt: now }));
                maybeNotify('üö® Missed assignments', `You have ${missed} missed assignment${missed === 1 ? '' : 's'}. Open the dashboard to catch up.`);
                showToast({
                    title: 'üö® Missed assignments',
                    message: `You have ${missed} missed assignment${missed === 1 ? '' : 's'}.`,
                    tone: 'warn',
                });
            }

            window.setInterval(() => {
                const missedNow = getMissedCount();
                if (missedNow <= 0) return;
                pulseMissedAssignments(20000);
                const ts = Date.now();
                localStorage.setItem(MISSED_STORAGE_KEY, JSON.stringify({ lastReminderAt: ts }));
                maybeNotify('üö® Reminder: missed assignments', `Still showing ${missedNow} missed assignment${missedNow === 1 ? '' : 's'}.`);
                showToast({
                    title: 'üö® Reminder',
                    message: `Still showing ${missedNow} missed assignment${missedNow === 1 ? '' : 's'}.`,
                    tone: 'warn',
                });
            }, minGapMs);
        }

        function loadLunchState() {
            try {
                const raw = localStorage.getItem(LUNCH_STORAGE_KEY);
                return raw ? JSON.parse(raw) : {};
            } catch {
                return {};
            }
        }

        function saveLunchState(state) {
            try {
                localStorage.setItem(LUNCH_STORAGE_KEY, JSON.stringify(state));
            } catch {
                // ignore
            }
        }

        function lunchKeyFor(timerEl) {
            const dayCard = timerEl.closest('.day-card');
            const day = dayCard?.dataset.day || 'unknown-day';
            const idx = Array.from(dayCard?.querySelectorAll('[data-lunch-timer]') || []).indexOf(timerEl);
            return `${day}:lunch:${idx}`;
        }

        function initLunchTimers() {
            const timers = Array.from(document.querySelectorAll('[data-lunch-timer]'));
            if (timers.length === 0) return;

            const state = loadLunchState();
            const running = new Map();

            function render(timerEl) {
                const key = lunchKeyFor(timerEl);
                const countdownEl = timerEl.querySelector('[data-lunch-countdown]');
                const startBtn = timerEl.querySelector('[data-lunch-start]');
                const stopBtn = timerEl.querySelector('[data-lunch-stop]');
                const resetBtn = timerEl.querySelector('[data-lunch-reset]');
                const defaultMinutes = Number(timerEl.dataset.defaultMinutes || '30');
                const defaultMs = TEST_MODE
                    ? TEST_LUNCH_DEFAULT_MS
                    : (Number.isFinite(defaultMinutes) ? defaultMinutes : 30) * 60 * 1000;

                const entry = state[key] || { endAt: null, remainingMs: defaultMs, isRunning: false };
                const remainingMs = entry.isRunning && entry.endAt ? entry.endAt - Date.now() : entry.remainingMs;
                const isDone = remainingMs <= 0;

                if (countdownEl) countdownEl.textContent = isDone ? '00:00' : msToMMSS(remainingMs);
                if (startBtn) startBtn.disabled = entry.isRunning;
                if (stopBtn) stopBtn.disabled = !entry.isRunning;
                if (resetBtn) resetBtn.disabled = entry.isRunning;

                timerEl.classList.toggle('lunch--done', isDone);
            }

            function stopTick(key) {
                const id = running.get(key);
                if (id) window.clearInterval(id);
                running.delete(key);
            }

            function tick(timerEl) {
                const key = lunchKeyFor(timerEl);
                const entry = state[key];
                if (!entry?.isRunning || !entry.endAt) return;
                const remainingMs = entry.endAt - Date.now();
                if (remainingMs <= 0) {
                    entry.isRunning = false;
                    entry.remainingMs = 0;
                    entry.endAt = null;
                    saveLunchState(state);
                    stopTick(key);
                    render(timerEl);
                    playBeep();
                    maybeNotify('‚è∞ Lunch is over', 'Time to head back ‚Äî your lunch timer ended.');
                    showToast({ title: '‚è∞ Lunch is over', message: 'Time to head back.', tone: 'good', timeoutMs: 10000 });
                    return;
                }
                render(timerEl);
            }

            function start(timerEl) {
                const key = lunchKeyFor(timerEl);
                const defaultMinutes = Number(timerEl.dataset.defaultMinutes || '30');
                const defaultMs = TEST_MODE
                    ? TEST_LUNCH_DEFAULT_MS
                    : (Number.isFinite(defaultMinutes) ? defaultMinutes : 30) * 60 * 1000;
                const entry = state[key] || { endAt: null, remainingMs: defaultMs, isRunning: false };
                const remainingMs = entry.remainingMs ?? defaultMs;
                entry.endAt = Date.now() + remainingMs;
                entry.isRunning = true;
                state[key] = entry;
                saveLunchState(state);
                render(timerEl);
                stopTick(key);
                running.set(key, window.setInterval(() => tick(timerEl), 250));
                maybeNotify('üçΩÔ∏è Lunch timer started', `I‚Äôll notify you in ${msToMMSS(remainingMs)}.`);
            }

            function pause(timerEl) {
                const key = lunchKeyFor(timerEl);
                const entry = state[key];
                if (!entry?.isRunning || !entry.endAt) return;
                entry.remainingMs = Math.max(0, entry.endAt - Date.now());
                entry.endAt = null;
                entry.isRunning = false;
                state[key] = entry;
                saveLunchState(state);
                stopTick(key);
                render(timerEl);
            }

            function reset(timerEl) {
                const key = lunchKeyFor(timerEl);
                const defaultMinutes = Number(timerEl.dataset.defaultMinutes || '30');
                const defaultMs = TEST_MODE
                    ? TEST_LUNCH_DEFAULT_MS
                    : (Number.isFinite(defaultMinutes) ? defaultMinutes : 30) * 60 * 1000;
                state[key] = { endAt: null, remainingMs: defaultMs, isRunning: false };
                saveLunchState(state);
                stopTick(key);
                render(timerEl);
            }

            for (const timerEl of timers) {
                render(timerEl);

                const key = lunchKeyFor(timerEl);
                const entry = state[key];
                if (entry?.isRunning) {
                    stopTick(key);
                    running.set(key, window.setInterval(() => tick(timerEl), 250));
                }

                timerEl.querySelector('[data-lunch-start]')?.addEventListener('click', () => start(timerEl));
                timerEl.querySelector('[data-lunch-stop]')?.addEventListener('click', () => pause(timerEl));
                timerEl.querySelector('[data-lunch-reset]')?.addEventListener('click', () => reset(timerEl));
            }
        }

        function bindTaskToggles(root = document) {
            root.addEventListener('click', (e) => {
                const toggle = e.target.closest('.task-toggle');
                if (!toggle) return;
                const task = toggle.closest('.task');
                const detail = task ? task.querySelector('.task-detail') : null;
                if (!task || !detail) return;

                const expanded = toggle.getAttribute('aria-expanded') === 'true';
                toggle.setAttribute('aria-expanded', String(!expanded));
                detail.hidden = expanded;
            });
        }

        function openTaskDetails(taskEl) {
            const toggle = taskEl.querySelector('.task-toggle');
            const detail = taskEl.querySelector('.task-detail');
            if (!toggle || !detail) return;
            toggle.setAttribute('aria-expanded', 'true');
            detail.hidden = false;
        }

        function highlightTask(taskEl) {
            taskEl.classList.remove('task--highlight');
            // force reflow so the animation can re-trigger
            void taskEl.offsetWidth;
            taskEl.classList.add('task--highlight');
            window.setTimeout(() => taskEl.classList.remove('task--highlight'), 1400);
        }

        function getFocusTasks(todayCard) {
            return getTasks(todayCard)
                .filter((t) => t.dataset.focus === 'true')
                .map((t) => {
                    const tag = t.dataset.tag || 'optional';
                    const check = t.querySelector('.task-check');
                    return {
                        el: t,
                        tag,
                        done: check ? check.checked : false,
                        weight: TAG_WEIGHT[tag] ?? 0,
                    };
                })
                .sort((a, b) => b.weight - a.weight);
        }

        function chooseNextBestTask(todayCard) {
            const focus = getFocusTasks(todayCard);
            const requiredFirst = focus.find((t) => t.tag === 'required' && !t.done);
            if (requiredFirst) return requiredFirst.el;

            const anyNext = focus.find((t) => !t.done);
            if (anyNext) return anyNext.el;

            // fallback: first incomplete required anywhere in today
            const all = getTasks(todayCard).map((t) => {
                const tag = t.dataset.tag || 'optional';
                const check = t.querySelector('.task-check');
                return { el: t, tag, done: check ? check.checked : false };
            });

            const req = all.find((t) => t.tag === 'required' && !t.done);
            if (req) return req.el;
            const any = all.find((t) => !t.done);
            return any ? any.el : null;
        }

        function bindNextBestAction() {
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-next-action]');
                if (!btn) return;
                const todayCard = btn.closest('.day-card');
                if (!todayCard) return;

                const nextTask = chooseNextBestTask(todayCard);
                if (!nextTask) {
                    showToast({ title: '‚úÖ All set', message: 'No remaining tasks to focus on right now.', tone: 'good' });
                    return;
                }

                openTaskDetails(nextTask);
                nextTask.scrollIntoView({ behavior: 'smooth', block: 'center' });
                highlightTask(nextTask);
            });
        }

        function bindDashboardScrollButtons() {
            const viewport = document.querySelector('[data-dashboard-viewport]');
            const leftBtn = document.querySelector('[data-scroll-left]');
            const rightBtn = document.querySelector('[data-scroll-right]');
            if (!viewport || !leftBtn || !rightBtn) return;

            const updateDisabled = () => {
                const max = viewport.scrollWidth - viewport.clientWidth;
                const hasOverflow = max > 2;
                leftBtn.style.display = hasOverflow ? '' : 'none';
                rightBtn.style.display = hasOverflow ? '' : 'none';
                leftBtn.disabled = viewport.scrollLeft <= 2;
                rightBtn.disabled = viewport.scrollLeft >= max - 2;
            };

            const scrollByAmount = (dir) => {
                const firstCard = viewport.querySelector('.day-card');
                const cardWidth = firstCard ? firstCard.getBoundingClientRect().width : 320;
                const gap = 12;
                const amount = Math.max(240, Math.round(cardWidth + gap));
                viewport.scrollBy({ left: dir * amount, behavior: 'smooth' });
            };

            leftBtn.addEventListener('click', () => scrollByAmount(-1));
            rightBtn.addEventListener('click', () => scrollByAmount(1));
            viewport.addEventListener('scroll', updateDisabled, { passive: true });
            window.addEventListener('resize', updateDisabled);
            updateDisabled();
        }

        function bindDayExpansion() {
            const grid = document.querySelector('.dashboard-grid');
            if (!grid) return;
            const scrollWrap = grid.closest('.dashboard-scroll');

            function collapseAll() {
                grid.classList.remove('dashboard-grid--expanded');
                if (scrollWrap) scrollWrap.classList.remove('dashboard-scroll--expanded');
                const cards = Array.from(grid.querySelectorAll('.day-card'));
                for (const card of cards) {
                    card.classList.remove('day-card--expanded', 'day-card--minimized');
                    const toggle = card.querySelector('[data-expand-day]');
                    if (toggle) toggle.setAttribute('aria-expanded', 'false');
                }
            }

            grid.addEventListener('click', (e) => {
                const btn = e.target.closest('[data-expand-day]');
                if (!btn) return;
                const card = btn.closest('.day-card');
                if (!card) return;

                const isExpanded = card.classList.contains('day-card--expanded');
                if (grid.classList.contains('dashboard-grid--expanded') && isExpanded) {
                    collapseAll();
                    return;
                }

                grid.classList.add('dashboard-grid--expanded');
                if (scrollWrap) scrollWrap.classList.add('dashboard-scroll--expanded');
                const cards = Array.from(grid.querySelectorAll('.day-card'));
                for (const c of cards) {
                    const toggle = c.querySelector('[data-expand-day]');
                    if (c === card) {
                        c.classList.add('day-card--expanded');
                        c.classList.remove('day-card--minimized');
                        if (toggle) toggle.setAttribute('aria-expanded', 'true');
                    } else {
                        c.classList.add('day-card--minimized');
                        c.classList.remove('day-card--expanded');
                        if (toggle) toggle.setAttribute('aria-expanded', 'false');
                    }
                }
            });

            // Optional: ESC collapses
            document.addEventListener('keydown', (e) => {
                if (e.key !== 'Escape') return;
                if (!grid.classList.contains('dashboard-grid--expanded')) return;
                collapseAll();
            });
        }

        function bindProgressUpdates() {
            document.addEventListener('change', (e) => {
                const check = e.target.closest('.task-check');
                if (!check) return;

                const task = check.closest('.task');
                const storageKey = taskStorageKeyFor(task);
                if (storageKey) {
                    TASK_STATE[storageKey] = Boolean(check.checked);
                    saveTaskState(TASK_STATE);
                }

                const dayCard = check.closest('.day-card');
                if (dayCard) updateDayProgress(dayCard);
                updateWeekProgress();

                const todayCard = document.querySelector('.day-card--today');
                if (todayCard) {
                    deriveTodayFocus(todayCard);
                    updateStatusPill(todayCard);
                }
            });
        }

        function init() {
            initThemeToggle();
            mountTestModePill();
            initAssignmentSearch();
            bindTaskToggles();
            bindProgressUpdates();
            bindNextBestAction();
            bindDayExpansion();
            bindDayNavigation();
            bindDashboardScrollButtons();

            TASK_STATE = loadTaskState();
            applyTaskState(TASK_STATE);

            restoreSelectedCard();

            // Seed day view data early so deep links work after first load.
            saveCurriculumSnapshot();

            const dayCards = Array.from(document.querySelectorAll('.day-card'));
            for (const card of dayCards) updateDayProgress(card);
            updateWeekProgress();
            const todayCard = document.querySelector('.day-card--today');
            if (todayCard) {
                deriveTodayFocus(todayCard);
                updateStatusPill(todayCard);
            }

            initLunchTimers();
            startMissedAssignmentReminders();
        }

        init();
    </script>
</body>

</html>